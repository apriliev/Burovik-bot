import logging
import time
import random
from aiogram import Bot, Dispatcher
from aiogram.types import Message

API_TOKEN = "8723285400:AAHqJZVe3-6gXRB0FC-BucIYrI4LYCcw5u8"

LINK = "https://max.ru/join/SkMCiN_-agLAdrVQJQDSy8qo-jsE8tsdGjNG-vu-n54"

MESSAGES = [
    f"Если захотите присоединиться к буровому сообществу, то добро пожаловать: {LINK}",
    f"Если интересно буровое сообщество, заходите сюда: {LINK}",
    f"Вот ссылка на буровое сообщество, присоединяйтесь: {LINK}",
    f"Буду рад видеть вас в буровом сообществе: {LINK}",
    f"Если тема бурения актуальна, то вам сюда: {LINK}",
    f"Заходите в буровое сообщество, вот ссылка: {LINK}",
    f"Если работаете в бурении, присоединяйтесь к сообществу: {LINK}",
    f"Приглашаю в буровое сообщество коллег по цеху: {LINK}",
    f"Хотите общаться с буровиками — заходите сюда: {LINK}",
    f"Буровое сообщество открыто для вас, ссылка: {LINK}",
    f"Если хотите быть в теме бурения, присоединяйтесь: {LINK}",
    f"За более плотное общение по бурению — в сообщество: {LINK}",
    f"Все обсуждения по бурению ведём здесь: {LINK}",
    f"Подключайтесь к общему чату буровиков по этой ссылке: {LINK}",
    f"Если интересны обсуждения по буровым вопросам — вам сюда: {LINK}",
    f"Приглашение в закрытое буровое сообщество: {LINK}",
    f"Коллеги по бурению общаются здесь, присоединяйтесь: {LINK}",
    f"Оставляю ссылку на наше буровое сообщество: {LINK}",
    f"Основной чат по бурению находится здесь: {LINK}",
    f"Если хотите задать вопросы по бурению — заходите: {LINK}",
    f"Приглашаю вас в чат практикующих буровиков: {LINK}",
    f"Здесь собираются специалисты по бурению: {LINK}",
    f"Если нужна живая практика по бурению, вступайте: {LINK}",
    f"Добавляйтесь в сообщество буровиков по ссылке: {LINK}",
    f"Все полезные контакты по бурению собираем здесь: {LINK}",
    f"Если хотите расширить круг общения в бурении — вам сюда: {LINK}",
    f"За обмен опытом по бурению — в этот чат: {LINK}",
    f"Вот приглашение в профильное буровое сообщество: {LINK}",
    f"Для профессиональных дискуссий по бурению — заходите: {LINK}",
    f"Если ищете «своих» в бурении — сообщество тут: {LINK}",
    f"Буровой чат, где делимся реальным опытом: {LINK}",
    f"Присоединяйтесь к нашим обсуждениям по буровым вопросам: {LINK}",
    f"Точка входа в наше буровое комьюнити: {LINK}",
    f"Если нужна движуха по бурению — вам в сообщество: {LINK}",
    f"Заходите в буровой чат, будем на связи: {LINK}",
    f"Если полезен обмен кейсами по бурению — присоединяйтесь: {LINK}",
    f"Буровое сообщество без воды и теории — только практика: {LINK}",
    f"Оставлю ссылку, вдруг пригодится для буровых вопросов: {LINK}",
    f"Здесь проще всего поймать буровиков онлайн: {LINK}",
    f"Если хотите получать обратную связь по бурению — приходите: {LINK}",
    f"Приглашаю в профессиональное буровое сообщество: {LINK}",
    f"Все интересные обсуждения по бурению проходят тут: {LINK}",
    f"Для обмена опытом и контактами по бурению — вот ссылка: {LINK}",
    f"Если нужна неформальная тусовка буровиков — заходите: {LINK}",
    f"Наш буровой чат открыт, присоединяйтесь по ссылке: {LINK}",
    f"Оставляю вход в закрытое сообщество буровиков: {LINK}",
    f"Если вы связаны с бурением — вам точно будет полезно: {LINK}",
    f"Буровой чат, где можно обсудить реальные задачи: {LINK}",
    f"Для рабочих обсуждений по бурению — вот наш чат: {LINK}",
    f"Если хотите в пул буровых контактов — заходите: {LINK}",
    f"Чат буровиков, без лишнего, только по делу: {LINK}",
    f"Если интересны живые кейсы по бурению — присоединяйтесь: {LINK}",
    f"Точка сбора буровиков из разных компаний: {LINK}",
    f"Заходите, если хотите быть в потоке буровых новостей: {LINK}",
    f"Если решаете буровые задачи — вам пригодится это сообщество: {LINK}",
    f"Вот ссылка на чат, где бурение обсуждаем ежедневно: {LINK}",
    f"Буровое комьюнити, в которое всегда можно написать: {LINK}",
    f"Если хотите быстро получать ответ от коллег по бурению — заходите: {LINK}",
    f"Чат практикующих буровиков, без теоретиков: {LINK}",
    f"Если ищете новые связи в бурении — присоединяйтесь: {LINK}",
    f"Оставлю вам ссылку на наше профильное комьюнити: {LINK}",
    f"Для обсуждения сложных буровых кейсов — вот чат: {LINK}",
    f"Если нужна поддержка коллег по бурению — заходите: {LINK}",
    f"Наше основное буровое сообщество здесь: {LINK}",
    f"Если хотите быть в курсе, чем живут буровики — присоединяйтесь: {LINK}",
    f"Чат, где бурение обсуждают без цензуры и маркетинга: {LINK}",
    f"Если есть вопросы по бурению — задавайте их в сообществе: {LINK}",
    f"Приглашаю в чат, где бурение — основная тема: {LINK}",
    f"Если хотите делиться опытом по бурению — вам сюда: {LINK}",
    f"Собираем всех неравнодушных к бурению в одном месте: {LINK}",
    f"Если хотите держать руку на пульсе буровых проектов — заходите: {LINK}",
    f"Вот ссылка на чат с живым общением по бурению: {LINK}",
    f"Если хотите пообщаться с коллегами из буровой отрасли — присоединяйтесь: {LINK}",
    f"Буровой чат, где вопросы не остаются без ответа: {LINK}",
    f"Если вы практикующий буровик — вам будет полезно здесь: {LINK}",
    f"Заходите в сообщество, где говорят на одном буровом языке: {LINK}",
    f"Если нужна «своя» среда по бурению — вот она: {LINK}",
    f"Оставляю ссылку на рабочий чат по буровым темам: {LINK}",
    f"Здесь можно обсудить и технику, и процессы бурения: {LINK}",
    f"Если хотите делиться результатами и фейлами по бурению — заходите: {LINK}",
    f"Буровое комьюнити с живыми обсуждениями, вот вход: {LINK}",
    f"Если интересно, как решают задачи другие буровики — присоединяйтесь: {LINK}",
    f"Чат для тех, кто ежедневно связан с бурением: {LINK}",
    f"Если нужен быстрый контакт с буровым сообществом — вот ссылка: {LINK}",
    f"Заходите в наше буровое комьюнити, будем на связи: {LINK}",
    f"Если хотите подключиться к обсуждениям буровых проектов — присоединяйтесь: {LINK}",
    f"Вот вход в чат для обмена опытом по бурению: {LINK}",
    f"Если вам близка тема бурения, буду рад видеть в сообществе: {LINK}",
    f"Буровой чат, где можно задать вопрос в любое время: {LINK}",
    f"Если хотите прокачивать себя в бурении — заходите: {LINK}",
    f"Приглашаю в сообщество, где бурение — основная повестка: {LINK}",
    f"Если нужен круг общения из буровиков — вот ссылка: {LINK}",
    f"Здесь можно спокойно обсудить все нюансы бурения: {LINK}",
    f"Если вам близка практическая сторона бурения — присоединяйтесь: {LINK}",
    f"Буровое комьюнити, где ценят опыт, а не регалии: {LINK}",
    f"Если хотите участвовать в обсуждениях буровых решений — вам сюда: {LINK}",
    f"Оставляю ссылку на чат коллег по буровой теме: {LINK}",
    f"Если интересно, как другие решают буровые задачи — заходите: {LINK}",
    f"Чат для обмена опытом, идеями и вопросами по бурению: {LINK}",
    f"Если хотите больше живого общения по буровым темам — присоединяйтесь: {LINK}",
    f"Вот ссылка на наше буровое сообщество, заходите в удобное время: {LINK}",
]

logging.basicConfig(level=logging.INFO)

bot = Bot(token=API_TOKEN)
dp = Dispatcher()

# {id_рассыльного_аккаунта: timestamp_последнего_ответа}
last_reply_time = {}

RATE_LIMIT_SECONDS = 1800  # 30 минут


def get_random_message() -> str:
    return random.choice(MESSAGES)


@dp.message()
async def send_link_with_limit(message: Message):
    sender_id = message.from_user.id
    now = time.time()

    last_time = last_reply_time.get(sender_id)

    if last_time is not None and (now - last_time) < RATE_LIMIT_SECONDS:
        logging.info(
            f"Skip reply for sender {sender_id}: last reply {int(now - last_time)} сек. назад"
        )
        return

    text = get_random_message()
    await message.reply(text)

    last_reply_time[sender_id] = now
    logging.info(f"Replied to sender {sender_id}, set last_reply_time = {now}")


async def main():
    await dp.start_polling(bot)


if __name__ == "__main__":
    import asyncio

    asyncio.run(main())
